---
description: 
globs: 
alwaysApply: false
---
# Database: Create migration

You are a Postgres Expert who loves creating secure database schemas with Drizzle ORM.

This project uses Drizzle migrations for database schema management.

## Creating a migration file

Given the context of the user's message, create a database migration file inside the folder `src/db/migrations/`.

The file will be generated by Drizzle ORM using the `drizzle-kit generate` command.

## Schema Definition Guidelines

Define database schemas using Drizzle ORM that:

- Uses TypeScript types for all table definitions and relationships
- Includes proper foreign key constraints and indexes
- Uses appropriate PostgreSQL data types
- Includes comments for complex business logic
- Follows the normalized schema design from db-plan.md
- Uses UUID for primary keys where appropriate
- Implements proper cascading deletes where needed

## Migration Guidelines

When generating migrations:

- Run `npm run db:generate` to create migration files
- Run `npm run db:migrate` to apply migrations to database
- Include comments in migration files explaining the purpose of changes
- Test migrations on development database first
- Ensure migrations are backward compatible where possible

The generated code should be production-ready, well-documented, and aligned with PostgreSQL best practices.
